# Sagan windows-malware.rules
# Copyright (c) 2009-2014, Quadrant Information Security <www.quadrantsec.com>
# All rights reserved.
#
# Please submit any custom rules or ideas to sagan-submit@quadrantsec.com or the sagan-sigs mailing list
#
#*************************************************************
#  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the
#  following conditions are met:
#
#  * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
#    disclaimer.
#  * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the
#    following disclaimer in the documentation and/or other materials provided with the distribution.
#  * Neither the name of the nor the names of its contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES,
#  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
#  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
#  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
#  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#*************************************************************
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] ZeroAccess Malware Detected "; content: " 861: "; content: "16464"; parse_proto; threshold: type limit, track by_src, count 5, seconds 300; classtype: network-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001735; sid: 5001735; rev:1;)
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] ZeroAccess Malware Detected "; content: " 861: "; content: "16465"; parse_proto; threshold: type limit, track by_src, count 5, seconds 300; classtype: network-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001736; sid: 5001736; rev:1;)
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] ZeroAccess Malware Detected"; content: " 861: "; content: "16470"; parse_proto; threshold: type limit, track by_src, count 5, seconds 300; classtype: network-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001737; sid: 5001737; rev:1;)
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] ZeroAccess Malware Detected "; content: " 861: "; content: "16471"; parse_proto; threshold: type limit, track by_src, count 5, seconds 300; classtype: network-event; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001738; sid: 5001738; rev:1;)
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] Black POS Malware Detected"; pcre: "/ 4657: | 567: | 4688: | 592: /"; content: "POSWDS";  classtype: trojan-activity; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001951; sid: 5001951; rev:3;)


#*************************************************************
# These rules are base upon research by Russ Anthony.  More
# information can be found in his white paper at:
# 
# https://www.sans.org/reading-room/whitepapers/logging/detecting-security-incidents-windows-workstation-event-logs-34262
#*************************************************************


# If the system is rebooting,  don't alarm on service shutdowns!

##alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] System shutdown [FLOWBIT SET]"; content: " 1074: "; program: USER32; flowbits: set, windows_reboot, 60; flowbits: noalert; classtype: system-event; reference: url,wiki.quadrantsec.com/bin/view/Main/5002014; sid: 5002014; rev:2;)
##alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] System protection disabled"; pcre: "/ 7034: | 7035: | 7046: | 7040: /" ; pcre: "/EMET|Defender/Anti-Virus/"; content: "stop control"; flowbits: isnotset, by_src, windows_reboot; program: Service_Control_Manager; classtype: trojan-activity; reference: url,wiki.quadrantsec.com/bin/view/Main/5002011; sid: 5002011; rev:2;)

alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] Suspicious misspelled process"; pcre: "/ 4688: | 592: /"; pcre: "/(scvhost|svcdost|scvdost|iexplorer)\.exe/i"; classtype: trojan-activity; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5001999; sid: 5001999; rev:1;)
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] Lower case drive letter used in process"; pcre: "/ 4688: | 592: /"; pcre: "/File Name: (c|d|e)\x3a/"; classtype: trojan-activity; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5002000; sid: 5002000; rev:1;)
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] Incorrect path called for svchost.exe"; pcre: "/ 4688: | 592: /"; content: "\svchost.exe"; content:!"C|3a|\WINDOWS\System32\svchost.exe"; nocase; classtype: trojan-activity; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5002001; sid: 5002001; rev:1;)
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] Incorrect path called for explorer.exe"; pcre: "/ 4688: | 592: /"; content: "\explorer.exe"; content:!"C|3a|\WINDOWS\explorer.exe"; nocase; classtype: trojan-activity; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5002002; sid: 5002002; rev:1;)
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] Suspicious application crash"; content: " 4097: "; pcre: "/Adobe|Microsoft Office|Java|wmplayer/"; classtype: trojan-activity; program: Security|Security-Auditing; reference: url,wiki.quadrantsec.com/bin/view/Main/5002003; sid: 5002003; rev:1;)
alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] Suspicious Tool Event"; pcre: "/ 4688: | 592: /"; pcre: "/win32dd.exe|win64dd.exe|cachedump|fgdump|gsecdump|lslsass|mimikatz|pwdump7|pwdumpx|pwdump|wce.exe|getlsasrvaddr|iam.exe|iam-alt|whosthere.exe|whosthere-alt|genhash/i"; program: Security|Security-Auditing; classtype: trojan-activity; reference: url,wiki.quadrantsec.com/bin/view/Main/5002006; sid: 5002006; rev:2;)
#alert syslog $HOME_NET any -> $EXTERNAL_NET any (msg: "[WINDOWS-MALWARE] Virus Found!"; content: "virus found"; nocase; classtype: trojan-activity; reference: url,wiki.quadrantsec.com/bin/view/Main/5002007; sid: 5002007; rev:1;)





